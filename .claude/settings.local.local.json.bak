{
  "permissions": {
    "allow": [
      "Skill(onboard)",
      "Skill(cleanup)",
      "Skill(audit)",
      "Skill(friction)",
      "Skill(code-review)",
      "Skill(exit)",
      "Skill(promote)",
      "WebSearch",
      "WebFetch",
      "Bash(git:*)",
      "Bash(gh:*)",
      "Bash(poetry:*)",
      "Bash(npm:*)",
      "Bash(npx:*)",
      "Bash(node:*)",
      "Bash(cat:*)",
      "Bash(ls:*)",
      "Bash(mkdir:*)",
      "Bash(rm:*)",
      "Bash(cp:*)",
      "Bash(mv:*)",
      "Bash(chmod:*)",
      "Bash(touch:*)",
      "Bash(grep:*)",
      "Bash(rg:*)",
      "Bash(find:*)",
      "Bash(head:*)",
      "Bash(tail:*)",
      "Bash(diff:*)",
      "Bash(curl:*)",
      "Bash(date:*)",
      "Bash(bash:*)",
      "Bash(./tools/**:*)",
      "Bash(/c/Users/mcwiz/Projects/**:*)",
      "Bash(where:*)",
      "Bash(whereis:*)",
      "Bash(type:*)",
      "Bash(gemini:*)",
      "Bash(powershell.exe:*)",
      "Bash(MSYS_NO_PATHCONV=1 aws:*)",
      "Bash(aws:*)",
      "Bash(python:*)",
      "Bash(python3:*)",
      "Bash(/c/Users/mcwiz/Projects/AgentOS/.claude/tools/gemini-model-check.sh \"You are reviewing an issue draft for the AgentOS project. Your role is Principal Architect.\n\nCRITICAL INSTRUCTIONS:\n1. Review this GitHub issue draft for completeness, clarity, and technical soundness\n2. Use the three-tier priority system:\n   - [BLOCKING] - Must fix before filing\n   - [HIGH] - Should fix before filing\n   - [SUGGESTION] - Nice to have\n3. Focus on: objective clarity, UX flow completeness, requirement gaps, security considerations, testability\n4. DO NOT offer to implement code\n\nISSUE DRAFT TO REVIEW:\n\n## Objective\n\nDevelop a PTY wrapper \\(unleashed.py\\) that eliminates permission friction by detecting Claude Code''s approval prompts and auto-approving them after a 10-second countdown, giving users a window to cancel.\n\n## UX Flow\n\n### Scenario 1: Auto-Approval \\(Happy Path\\)\n1. User runs unleashed \\(wrapper script\\) instead of claude\n2. Claude spawns inside the wrapper with full TUI fidelity\n3. User works normally; all input/output passes through transparently\n4. Claude triggers a permission prompt \\(footer appears: Esc to cancel - Tab to add additional instructions\\)\n5. Wrapper detects footer, displays overlay: [UNLEASHED] Auto-approving in 10s... \\(Press any key to cancel\\)\n6. 10 seconds pass with no user input\n7. Wrapper injects Enter, prompt is approved\n8. Log entry: [AUTO-APPROVED] <timestamp>\n\n### Scenario 2: User Cancels\n1. Same as above through step 5\n2. User presses any key during countdown\n3. Wrapper aborts automation, passes keypress to Claude\n4. User regains manual control\n5. Log entry: [CANCELLED BY USER] <timestamp>\n\n### Scenario 3: Non-Prompt Output\n1. User runs unleashed, works with Claude\n2. Claude outputs text that does not contain the footer\n3. Wrapper passes through unchanged, no countdown triggered\n\n## Requirements\n\n### Core PTY Proxy\n1. Spawn claude using winpty.PtyProcess.spawn\\(\\) \\(Git Bash environment\\)\n2. Maintain full TUI fidelity \\(ANSI colors, cursor positioning, dimensions\\)\n3. Pass through user input seamlessly when not in countdown mode\n4. Handle window resize events\n\n### Footer Detection\n1. Detect exact string: Esc to cancel - Tab to add additional instructions \\(note: - is Unicode middle dot U+00B7\\)\n2. Optional secondary validation: presence of horizontal rule in recent buffer\n3. Detection must work with ANSI escape sequences present in buffer\n\n### Dead Man Switch \\(10s Delay\\)\n1. When footer detected, start 10-second countdown\n2. Display visible status: [UNLEASHED] Auto-approving in 10s... \\(Press any key to cancel\\)\n3. Countdown must update visibly \\(10, 9, 8...\\)\n4. If user presses ANY key during countdown:\n   - Abort automation immediately\n   - Pass the keypress through to Claude\n   - Log: [CANCELLED BY USER]\n5. If countdown completes \\(10s, no input\\):\n   - Inject carriage return\n   - Log: [AUTO-APPROVED]\n\n### Logging\n1. Full session capture \\(raw bytes\\) to logs/unleashed_TIMESTAMP.log\n2. Structured event log: logs/unleashed_events_TIMESTAMP.json\n3. Events: START, FOOTER_DETECTED, COUNTDOWN_START, AUTO_APPROVED, CANCELLED_BY_USER, END\n\n## Technical Approach\n\n- PTY Library: winpty \\(already used by claude-usage-scraper.py\\)\n- Threading Model: Background thread + queue for non-blocking reads \\(same pattern as scraper\\)\n- Footer Regex: Esc to cancel.*Tab to add additional instructions \\(with Unicode handling\\)\n- ANSI Stripping: Use existing pattern from scraper for detection, preserve for display\n- Input Monitoring: Non-blocking check during countdown loop\n\n## Security Considerations\n\n- Footer-only detection: No command inspection or filtering \\(per user decision\\)\n- User override: Any keypress cancels automation - user always has control\n- 10-second delay: Provides visual review window before any auto-action\n- Full logging: All auto-approvals logged for audit trail\n- Not a security tool: This is a convenience wrapper, not a sandbox\n\n## Files to Create/Modify\n\n- tools/unleashed.py - New: Main PTY wrapper implementation\n- tools/unleashed - New: Bash wrapper script for PATH integration\n- docs/skills/0603-unleashed.md - New: Documentation\n\n## Dependencies\n\n- winpty package \\(already in pyproject.toml from scraper\\)\n- No blockers from other issues\n\n## Out of Scope \\(Future\\)\n\n- Command blacklist/whitelist filtering - deferred \\(not requested\\)\n- Cross-platform Unix pty support - deferred \\(Windows Git Bash only for MVP\\)\n- Configuration file for delay duration - deferred \\(hardcoded 10s\\)\n- Integration with .claude/settings.json - deferred \\(standalone wrapper only\\)\n\n## Acceptance Criteria\n\n- Running unleashed spawns Claude with identical TUI appearance\n- Footer detection triggers countdown\n- Countdown displays visibly with second-by-second update\n- Pressing any key during countdown aborts and passes key to Claude\n- Uninterrupted countdown injects Enter and approves prompt\n- Session log captures full raw output\n- Event log captures structured AUTO_APPROVED / CANCELLED_BY_USER events\n\n## Definition of Done\n\n### Implementation\n- Core PTY proxy with transparent passthrough\n- Footer detection with Unicode handling\n- 10-second countdown with visible display\n- User interrupt detection and handling\n- Auto-inject Enter after countdown\n- Graceful cleanup on exit \\(Ctrl+C, process death\\)\n\n### Tools\n- tools/unleashed.py created following scraper patterns\n- tools/unleashed bash wrapper created\n- --help flag with usage instructions\n- --dry-run flag to test detection without injection\n\n### Documentation\n- docs/skills/0603-unleashed.md created\n- Tool added to docs/index.md\n\n### Reports \\(Pre-Merge Gate\\)\n- docs/reports/IssueID/implementation-report.md created\n- docs/reports/IssueID/test-report.md created\n\n## Testing Notes\n\nTo test footer detection:\n1. Run unleashed --dry-run\n2. Start a Claude session\n3. Run a command that triggers permission \\(e.g., ls /\\)\n4. Verify countdown appears\n5. Test: let it complete \\(auto-approve\\)\n6. Test: press key during countdown \\(cancel\\)\n7. Verify logs capture both scenarios\n\nOUTPUT FORMAT:\n## [BLOCKING] Issues\n- Issue 1...\n\n## [HIGH] Priority Issues\n- Issue 1...\n\n## [SUGGESTION] Improvements\n- Suggestion 1...\n\n## Summary\nOverall assessment and next steps recommendation.\")",
      "Bash(GEMINI_RETRY_MAX=3 GEMINI_RETRY_BASE_DELAY=5 poetry run python:*)",
      "Bash(GEMINI_RETRY_MAX=2 GEMINI_RETRY_BASE_DELAY=5 python:*)",
      "Bash(GEMINI_RETRY_MAX=5 GEMINI_RETRY_BASE_DELAY=30 python:*)",
      "Bash(GEMINI_RETRY_MAX=3 GEMINI_RETRY_BASE_DELAY=10 python:*)",
      "Bash(GEMINI_RETRY_MAX=10 GEMINI_RETRY_BASE_DELAY=30 python tools/gemini-retry.py:*)",
      "Bash(GEMINI_RETRY_DEBUG=1 GEMINI_RETRY_MAX=2 GEMINI_RETRY_BASE_DELAY=10 python:*)",
      "Bash(GEMINI_RETRY_DEBUG=1 GEMINI_RETRY_MAX=3 GEMINI_RETRY_BASE_DELAY=10 python:*)"
    ],
    "deny": [
      "Read(.env)",
      "Read(.env.*)",
      "Bash(git reset --hard:*)",
      "Bash(git push --force:*)",
      "Bash(git push -f:*)",
      "Bash(pip install:*)",
      "Bash(rm -rf /:*)",
      "Bash(eval:*)"
    ]
  }
}
